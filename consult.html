<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤šå¤šè¬äº‹å±‹ï½œå‘½ç†è«®è©¢</title>
    
    <!-- 1. æ ¸å¿ƒå‡½å¼åº« -->
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">

    <style>
        /* --- å…¨åŸŸè¨­å®š --- */
        :root {
            --bg-base: #fdfbf7;       /* ç±³ç™½å®£ç´™åº• */
            --primary: #5D4037;       /* æ·±æ£•ä¸»è‰² */
            --accent-light: #FFECB3;  /* æ·ºæ©˜é»ƒ */
            --accent-pink: #FFCCBC;   /* æ·ºç²‰æ©˜ */
            --active-tab: #FFE0B2;    /* é¸ä¸­é ç±¤ */
            
            /* äº”è¡Œè‰² */
            --wood: #388E3C; --fire: #D32F2F; --earth: #795548; --metal: #FBC02D; --water: #1976D2;
        }

        body {
            font-family: 'Zen Maru Gothic', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-base);
            color: var(--primary);
            padding-top: 70px; /* ç•™çµ¦å›ºå®šå°èˆªåˆ— */
            padding-bottom: 40px;
        }

        /* --- å°èˆªåˆ— (å›ºå®šç½®é ‚) --- */
        .nav-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 100;
            display: flex;
            overflow-x: auto; /* å…è¨±å°è¢å¹•æ©«æ»‘ï¼Œé›–ç„¶æˆ‘å€‘è¨­è¨ˆç‚º4å€‹å‰›å¥½ */
        }

        .nav-item {
            flex: 1;
            padding: 15px 5px;
            text-align: center;
            font-weight: bold;
            font-size: 15px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
        }

        .nav-item.active {
            color: var(--primary);
            background-color: var(--active-tab);
            border-bottom: 3px solid var(--primary);
        }

        /* --- å…§å®¹å€å¡Šæ§åˆ¶ --- */
        .tab-content { display: none; animation: fadeIn 0.5s; padding: 0 20px; }
        .tab-content.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- å¡ç‰‡æ¨£å¼ --- */
        .card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #eee;
            box-shadow: 0 4px 6px rgba(0,0,0,0.02);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--accent-pink);
            display: flex;
            align-items: center;
        }
        
        .card-title svg { margin-right: 8px; width: 24px; height: 24px; stroke: var(--primary); }

        /* --- åƒ¹ç›®è¡¨äº’å‹•å…ƒä»¶ --- */
        .option-group { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        
        .check-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        .check-btn.selected {
            background-color: var(--primary);
            color: #fff;
            border-color: var(--primary);
        }

        .price-display {
            background: var(--accent-light);
            padding: 15px;
            border-radius: 8px;
            text-align: right;
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 10px;
        }

        /* --- å…«å­—æ’ç›¤æ¨£å¼ (ç¹¼æ‰¿è‡ª Pro+) --- */
        .bazi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            text-align: center;
            margin-bottom: 15px;
        }
        .column-header { font-size: 12px; color: #888; margin-bottom: 4px; }
        .char-container {
            background: #fff; border: 1px solid #ddd; border-radius: 6px;
            padding: 8px 2px; min-height: 70px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .ten-god-top { font-size: 10px; color: #8d6e63; height: 12px; margin-bottom: 2px; }
        .char-main { font-size: 22px; font-weight: bold; line-height: 1.1; }
        .hidden-stems { font-size: 10px; color: #999; margin-top: 4px; line-height: 1.2; }
        .day-master-box { border: 2px solid var(--primary); background-color: #fff8e1; }
        
        /* äº”è¡Œé¡è‰² */
        .w-wood { color: var(--wood); }
        .w-fire { color: var(--fire); }
        .w-earth { color: var(--earth); }
        .w-metal { color: var(--metal); }
        .w-water { color: var(--water); }

        /* æŒ‰éˆ•æ¨£å¼ */
        .action-btn {
            width: 100%;
            background-color: var(--primary);
            color: #fff;
            padding: 14px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(93, 64, 55, 0.3);
            transition: transform 0.1s;
        }
        .action-btn:active { transform: scale(0.98); }

    </style>
</head>
<body>

    <!-- 1. å›ºå®šå°èˆªåˆ— -->
    <nav class="nav-bar">
        <div class="nav-item active" onclick="switchTab('home')">é¦–é </div>
        <div class="nav-item" onclick="switchTab('pricing')">åƒ¹ç›®è¡¨</div>
        <div class="nav-item" onclick="switchTab('bazi')">å¿«é€Ÿå…«å­—</div>
        <div class="nav-item" onclick="switchTab('courses')">ç·šä¸Šèª²ç¨‹</div>
    </nav>

    <!-- 2. åˆ†é å…§å®¹å€ -->

    <!-- Tab 1: é¦–é  -->
    <div id="home" class="tab-content active">
        <div class="text-center mb-6 mt-4">
            <h1 class="text-2xl font-bold tracking-widest text-gray-800">å¤šå¤šè¬äº‹å±‹</h1>
            <p class="text-sm text-gray-500 mt-2">å‘½ç†è«®è©¢ â€¢ é‹å‹¢è§£æ â€¢ å¿ƒéˆç™‚ç™’</p>
        </div>

        <div class="card">
            <div class="card-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                æœå‹™é …ç›®
            </div>
            <ul class="space-y-4 pl-2">
                <li class="flex items-start">
                    <span class="font-bold mr-2 text-yellow-700">A.</span>
                    <div>
                        <strong class="block text-gray-800">ç´«å¾®æ–—æ•¸</strong>
                        <span class="text-sm text-gray-500">å‘½ç›¤è§£æã€å•é¡Œè§£æƒ‘<br>**æµå¹´å„æœˆé‹å‹¢åˆ†æ**<br>åƒ…æ–¼ä¸­ç§‹è‡³æ˜¥ç¯€æœŸé–“æœå‹™ï¼Œè©³è¦‹å…¬å‘Š</span>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="font-bold mr-2 text-yellow-700">a.</span>
                    <div>
                        <strong class="block text-gray-800">ç´«å¾®æ–—æ•¸æµå¹´å„æœˆé‹å‹¢åˆ†æ</strong>
                        <span class="text-sm text-gray-500">çµåˆæœ¬å‘½ã€å¤§é‹ã€å°é™ã€æµå¹´ã€æµæœˆäº”ç›¤åˆä¸€ï¼Œæ­é…å…«å­—é‹å‹¢æµè½‰<br>**åƒ…æ–¼ä¸­ç§‹è‡³æ˜¥ç¯€æœŸé–“æœå‹™ï¼Œè©³è¦‹å…¬å‘Š**</span>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="font-bold mr-2 text-yellow-700">B.</span>
                    <div>
                        <strong class="block text-gray-800">å…«å­—å‘½ç†</strong>
                        <span class="text-sm text-gray-500">åŸå±€å–œç”¨ç¥ã€é‹å‹¢æµè½‰è§£æ</span>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="font-bold mr-2 text-yellow-700">C.</span>
                    <div>
                        <strong class="block text-gray-800">å¡ç‰Œå åœ</strong>
                        <span class="text-sm text-gray-500">å¡”ç¾…ã€ç´«å¾®ã€æ˜“ç¶“ã€ç«ç‘°ç¥è«­</span>
                    </div>
                </li>
                <li class="flex items-start">
                    <span class="font-bold mr-2 text-yellow-700">D.</span>
                    <div>
                        <strong class="block text-gray-800">å¯µç‰©æºé€š</strong>
                        <span class="text-sm text-gray-500">è«‹æ´½ IG: <a href="https://instagram.com/trueme_life_tw" target="_blank" class="text-blue-600 underline">ç°‡å’ªæ‰‹ä½œtrueme_life_tw</a></span>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <!-- Tab 2: åƒ¹ç›®è¡¨ (å«è¨ˆç®—èˆ‡é ç´„) -->
    <div id="pricing" class="tab-content">
        <div class="card">
            <div class="card-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M2 12h20"/></svg>
                A. ç´«å¾®æ–—æ•¸
            </div>
            <p class="text-sm text-gray-500 mb-3">
                åŸºç¤è²»ç”¨ $1000 (å«ä¸€é …å•é¡Œ)ã€‚<br>æ¯åŠ ä¸€é … +$400ã€‚<br>ä¸Šé™ $3000 (å•åˆ°é£½)ã€‚
            </p>
            <div class="option-group" id="ziwei-options">
                <div class="check-btn selected" id="ziwei-none" onclick="toggleZiwei(this, 'none')">ä¸è«®è©¢</div>
                <div class="check-btn" onclick="toggleZiwei(this, 'å·¥ä½œ')">å·¥ä½œ</div>
                <div class="check-btn" onclick="toggleZiwei(this, 'æ„Ÿæƒ…')">æ„Ÿæƒ…</div>
                <div class="check-btn" onclick="toggleZiwei(this, 'è²¡é‹')">è²¡é‹</div>
                <div class="check-btn" onclick="toggleZiwei(this, 'å¥åº·')">å¥åº·</div>
                <div class="check-btn" onclick="toggleZiwei(this, 'å®¶åº­')">å®¶åº­</div>
                <div class="check-btn" onclick="toggleZiwei(this, 'æµå¹´')">æµå¹´</div>
                <div class="check-btn" onclick="toggleZiwei(this, 'å…¶ä»–')">å…¶ä»–</div>
                <div class="check-btn w-full text-center" style="border-color: #8B0000; color:#8B0000" onclick="toggleZiwei(this, 'å•åˆ°é£½')">âˆ å•åˆ°é£½ (å…¨é¸)</div>
            </div>
            <div class="text-right text-gray-600 text-sm">ç´«å¾®å°è¨ˆï¼š$<span id="ziwei-price">0</span></div>
        </div>

        <div class="card">
            <div class="card-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                B. å…«å­—è§£æ
            </div>
            <p class="text-sm text-gray-500 mb-3">
                åŸå±€è§£æã€å–œç”¨åˆ†æã€å¤§é‹æµå¹´æµæœˆé‹å‹¢ã€‚
            </p>
            <div class="space-y-2">
                <label class="flex items-center p-2 border rounded hover:bg-gray-50">
                    <input type="radio" name="bazi-option" value="0" checked onchange="calcTotal()" class="mr-3">
                    <span class="text-gray-400">ä¸è§£æ</span>
                </label>
                <label class="flex items-center p-2 border rounded hover:bg-gray-50">
                    <input type="radio" name="bazi-option" value="1" onchange="calcTotal()" class="mr-3">
                    <span>å–®æ¬¡è§£æ ($400)</span>
                </label>
            </div>
        </div>

        <div class="card">
            <div class="card-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
                C. å¡ç‰Œå åœ
            </div>
            <p class="text-sm text-gray-500 mb-3">è«‹é¸æ“‡å åœé …ç›®ï¼š</p>
            <div class="space-y-2">
                <label class="flex items-center p-2 border rounded hover:bg-gray-50">
                    <input type="radio" name="card-option" value="0" data-name="ç„¡" data-price="0" checked onchange="calcTotal()" class="mr-3">
                    <span class="text-gray-400">ä¸å åœ</span>
                </label>
                <label class="flex items-center p-2 border rounded hover:bg-gray-50">
                    <input type="radio" name="card-option" value="1" data-name="æ˜“ç¶“ç‰Œ (2å¼µ)" data-price="50" onchange="calcTotal()" class="mr-3">
                    <span>æ˜“ç¶“ç‰Œ (2å¼µ) $50</span>
                </label>
                <label class="flex items-center p-2 border rounded hover:bg-gray-50">
                    <input type="radio" name="card-option" value="2" data-name="å¡”ç¾…ç‰Œ (3å¼µ)" data-price="150" onchange="calcTotal()" class="mr-3">
                    <span>å¡”ç¾…ç‰Œ (3å¼µ) $150</span>
                </label>
                <label class="flex items-center p-2 border rounded hover:bg-gray-50">
                    <input type="radio" name="card-option" value="3" data-name="ç´«å¾®ç‰Œ (3å¼µ)" data-price="150" onchange="calcTotal()" class="mr-3">
                    <span>ç´«å¾®ç‰Œ (3å¼µ) $150</span>
                </label>
                <label class="flex items-center p-2 border rounded hover:bg-gray-50">
                    <input type="radio" name="card-option" value="4" data-name="è§£æƒ‘ç‰Œçµ„ (9å¼µ)" data-price="300" onchange="calcTotal()" class="mr-3">
                    <span>è§£æƒ‘ç‰Œçµ„ (9å¼µ) $300 (æ¨è–¦)</span>
                </label>
            </div>
        </div>

        <div class="price-display">
            ç¸½é‡‘é¡ï¼š$<span id="final-total">0</span>
        </div>
        <button class="action-btn" onclick="sendReservation()">é€å‡ºé ç´„</button>
        <p class="text-xs text-center mt-2 text-gray-400">é€å‡ºå¾Œè«‹ç­‰å¾…å¤šå¤šè€å¸«ç¢ºèª</p>
    </div>

    <!-- Tab 3: å¿«é€Ÿå…«å­— (æ•´åˆç‰ˆ) -->
    <div id="bazi" class="tab-content">
        <div class="card">
            <div class="card-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                å…«å­—é€ŸæŸ¥
            </div>
            <div class="mb-4 text-center">
                <label class="block text-sm text-gray-500 mb-1">è«‹è¼¸å…¥åœ‹æ›†ç”Ÿè¾°</label>
                <input type="datetime-local" id="birthDate" class="w-full p-2 border rounded text-center bg-gray-50">
            </div>
            <button class="w-full bg-gray-700 text-white py-2 rounded-full mb-6 font-bold" onclick="calculateBazi()">é–‹å§‹æ’ç›¤</button>

            <!-- çµæœé¡¯ç¤ºå€ (é è¨­éš±è—) -->
            <div id="bazi-result" style="display:none;">
                <div class="bazi-grid">
                    <div class="column-header">å¹´æŸ±</div>
                    <div class="column-header">æœˆæŸ±</div>
                    <div class="column-header">æ—¥æŸ±</div>
                    <div class="column-header">æ™‚æŸ±</div>

                    <!-- å¤©å¹² -->
                    <div id="year-gan" class="char-container"></div>
                    <div id="month-gan" class="char-container"></div>
                    <div id="day-gan" class="char-container day-master-box"></div>
                    <div id="time-gan" class="char-container"></div>

                    <!-- åœ°æ”¯ -->
                    <div id="year-zhi" class="char-container"></div>
                    <div id="month-zhi" class="char-container"></div>
                    <div id="day-zhi" class="char-container"></div>
                    <div id="time-zhi" class="char-container"></div>
                </div>

                <!-- äº”è¡Œåœ–è¡¨ -->
                <div class="border p-3 rounded mb-4">
                    <h4 class="text-sm font-bold text-center mb-2">äº”è¡Œèƒ½é‡</h4>
                    <div style="height:150px"><canvas id="wuxingChart"></canvas></div>
                    <div id="wuxing-text" class="text-xs text-center mt-2 text-red-800"></div>
                </div>

                <!-- æ€§æ ¼ -->
                <div class="bg-orange-50 p-3 rounded border-l-4 border-yellow-700">
                    <h4 class="font-bold text-yellow-900 mb-1"><span id="dm-label"></span>æ€§æ ¼åˆ†æ</h4>
                    <div id="dm-desc" class="text-sm text-gray-700 text-justify"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab 4: ç·šä¸Šèª²ç¨‹ -->
    <div id="courses" class="tab-content">
        <div class="card">
            <div class="card-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                ç´«å¾®æ–—æ•¸åˆç´šç­
            </div>
            <p class="text-sm text-gray-600 mb-4">é©åˆå®Œå…¨é›¶åŸºç¤ï¼Œå¾èªè­˜å‘½ç›¤å®®ä½æ˜Ÿæ€§é–‹å§‹ï¼ŒæŒæ¡è‡ªå·±çš„äººç”Ÿã€‚</p>
            <div class="flex justify-between items-center">
                <span class="text-xl font-bold text-red-800">$3,600</span>
                <button class="bg-yellow-600 text-white px-4 py-2 rounded-full text-sm" onclick="window.open('https://muchmore828.kaik.io/courses/beginner')">å‰å¾€å ±åï¼Œåˆ¥å¿˜äº†æŠ˜æ‰£ç¢¼</button>
            </div>
        </div>

        <div class="card">
            <div class="card-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                ç´«å¾®æ–—æ•¸ä¸­ç´šç­
            </div>
            <p class="text-sm text-gray-600 mb-4">æ·±å…¥å››åŒ–æ‡‰ç”¨èˆ‡æµå¹´æ¨ç®—ï¼Œå­¸ç¿’å¦‚ä½•è§£ç›¤èˆ‡é‹å‹¢é æ¸¬ã€‚</p>
            <div class="flex justify-between items-center">
                <span class="text-xl font-bold text-red-800">$10,800</span>
                <button class="bg-yellow-600 text-white px-4 py-2 rounded-full text-sm" onclick="window.open('https://muchmore828.kaik.io/courses/advanced')">å‰å¾€å ±åï¼Œåˆ¥å¿˜äº†æŠ˜æ‰£ç¢¼</button>
            </div>
        </div>

        <div class="card">
            <div class="card-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                å…«å­—è¡Œé‹ç­
            </div>
            <p class="text-sm text-gray-600 mb-4">äº†è§£äº”è¡Œç”Ÿå‰‹èˆ‡å¤§é‹æµå¹´ï¼ŒæŒæ¡äººç”Ÿèµ·ä¼çš„é—œéµæ™‚æ©Ÿã€‚<br>èª²ç¨‹ä¸Šå‚³ä¸­</p>
            <div class="flex justify-between items-center">
                <span class="text-xl font-bold text-red-800">$3,600</span>
                <button class="bg-yellow-600 text-white px-4 py-2 rounded-full text-sm" onclick="window.open('https://example.com/course3')">èª²ç¨‹ä¸Šå‚³ä¸­</button>
            </div>
        </div>
    </div>

    <script>
        // â˜…â˜…â˜… è«‹å¡«å…¥ LIFF ID â˜…â˜…â˜…
        const YOUR_LIFF_ID = "è«‹å¡«å…¥æ‚¨çš„LIFF_ID";

        // =======================
        // 1. åˆå§‹åŒ–èˆ‡é ç±¤åˆ‡æ›
        // =======================
        document.addEventListener('DOMContentLoaded', function() {
            liff.init({ liffId: YOUR_LIFF_ID }).catch(err => console.error(err));
        });

        function switchTab(tabId) {
            // éš±è—æ‰€æœ‰å…§å®¹
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            // é¡¯ç¤ºé¸ä¸­å…§å®¹
            document.getElementById(tabId).classList.add('active');
            
            // æ›´æ–°å°èˆªç‹€æ…‹ (é€™è£¡ç°¡å–®ç”¨ç´¢å¼•å°æ‡‰ï¼Œæˆ–æ ¹æ“šonclickæ–‡å­—)
            const navItems = document.querySelectorAll('.nav-item');
            if(tabId === 'home') navItems[0].classList.add('active');
            if(tabId === 'pricing') navItems[1].classList.add('active');
            if(tabId === 'bazi') navItems[2].classList.add('active');
            if(tabId === 'courses') navItems[3].classList.add('active');
            
            window.scrollTo(0, 0);
        }

        // =======================
        // 2. åƒ¹ç›®è¡¨è¨ˆç®—é‚è¼¯
        // =======================
        let selectedZiwei = [];

        function toggleZiwei(btn, item) {
            const noneBtn = document.getElementById('ziwei-none');
            
            if (item === 'none') {
                selectedZiwei = [];
                document.querySelectorAll('#ziwei-options .check-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
            } else {
                // å¦‚æœé»é¸ä»»ä½•é …ç›®ï¼Œå–æ¶ˆã€Œä¸é€²è¡Œã€çš„é¸å–
                if (noneBtn.classList.contains('selected')) {
                    noneBtn.classList.remove('selected');
                }

                if (item === 'å•åˆ°é£½') {
                    // å¦‚æœé¸å•åˆ°é£½
                    if (selectedZiwei.includes('å•åˆ°é£½')) {
                        // å–æ¶ˆå•åˆ°é£½ -> å›åˆ°å…¨ç©º (é¸å–ä¸é€²è¡Œ)
                        selectedZiwei = [];
                        btn.classList.remove('selected');
                        noneBtn.classList.add('selected');
                    } else {
                        // é¸å–å•åˆ°é£½ -> æ¸…é™¤å…¶ä»–ä¸€èˆ¬é …ç›®
                        selectedZiwei = ['å•åˆ°é£½'];
                        document.querySelectorAll('#ziwei-options .check-btn').forEach(b => {
                            if (b !== btn && b !== noneBtn) b.classList.remove('selected');
                        });
                        btn.classList.add('selected');
                    }
                } else {
                    // é»é¸ä¸€èˆ¬é …ç›®
                    if (selectedZiwei.includes('å•åˆ°é£½')) {
                        // å¦‚æœåŸæœ¬æ˜¯å•åˆ°é£½ï¼Œç§»é™¤å•åˆ°é£½ï¼ŒåŠ å…¥æ–°é …
                        selectedZiwei = [item];
                        document.querySelectorAll('#ziwei-options .check-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                    } else {
                        if (selectedZiwei.includes(item)) {
                            selectedZiwei = selectedZiwei.filter(i => i !== item);
                            btn.classList.remove('selected');
                        } else {
                            selectedZiwei.push(item);
                            btn.classList.add('selected');
                        }
                    }
                    
                    // å¦‚æœå–æ¶ˆå®Œæ‰€æœ‰é …ç›®ï¼Œè‡ªå‹•é¸å›ã€Œä¸é€²è¡Œã€
                    if (selectedZiwei.length === 0) {
                        noneBtn.classList.add('selected');
                    }
                }
            }
            calcTotal();
        }

        function calcTotal() {
            // A. ç´«å¾®è¨ˆç®—
            let ziweiPrice = 0;
            if (selectedZiwei.includes('å•åˆ°é£½')) {
                ziweiPrice = 3000;
            } else if (selectedZiwei.length > 0) {
                ziweiPrice = 1000 + (selectedZiwei.length - 1) * 400;
                if (ziweiPrice > 3000) ziweiPrice = 3000; // ä¸Šé™ 3000
            }
            document.getElementById('ziwei-price').innerText = ziweiPrice;

            // B. å…«å­—è¨ˆç®— (æ”¹ç‚º Radio Button é‚è¼¯)
            const baziOption = document.querySelector('input[name="bazi-option"]:checked');
            let baziPrice = (baziOption && baziOption.value === '1') ? 400 : 0;

            // C. å¡ç‰Œè¨ˆç®—
            const cardOption = document.querySelector('input[name="card-option"]:checked');
            let cardPrice = parseInt(cardOption.dataset.price || 0);

            // ç¸½è¨ˆ
            let total = ziweiPrice + baziPrice + cardPrice;
            document.getElementById('final-total').innerText = total;
        }

        function sendReservation() {
            // æ”¶é›†è³‡æ–™
            const baziOption = document.querySelector('input[name="bazi-option"]:checked');
            const cardOption = document.querySelector('input[name="card-option"]:checked');
            const cardName = cardOption.dataset.name;
            const total = document.getElementById('final-total').innerText;

            let details = "";
            if (selectedZiwei.length > 0) details += `ğŸŸ£ ç´«å¾®æ–—æ•¸ï¼š${selectedZiwei.join(', ')}\n`;
            if (baziOption && baziOption.value === '1') details += `ğŸŸ¡ å…«å­—è§£æï¼šå–®æ¬¡\n`;
            if (cardName !== "ç„¡") details += `ğŸƒ å¡ç‰Œå åœï¼š${cardName}\n`;

            if (details === "") {
                alert("è«‹è‡³å°‘é¸æ“‡ä¸€é …æœå‹™å–”ï¼");
                return;
            }

            const msg = `ã€ğŸ”® å¤šå¤šè¬äº‹å±‹é ç´„å–®ã€‘\n\n` +
                        details +
                        `------------------\n` +
                        `ğŸ’° é ä¼°é‡‘é¡ï¼š$${total}\n\n` +
                        `ç¨å¾Œå¤šå¤šè€å¸«å°‡èˆ‡æ‚¨ç¢ºèªå…§å®¹èˆ‡é ç´„æ™‚é–“ï¼Œè¬è¬ï¼`;

            if (liff.isInClient()) {
                liff.sendMessages([{ type: 'text', text: msg }])
                    .then(() => liff.closeWindow())
                    .catch(err => alert('ç™¼é€å¤±æ•—ï¼š' + err));
            } else {
                alert("é è¦½è¨Šæ¯ï¼š\n\n" + msg);
            }
        }

        // =======================
        // 3. å…«å­—è¨ˆç®—é‚è¼¯ (Pro+ æ•´åˆç‰ˆ)
        // =======================
        const WUXING = { "ç”²":"æœ¨", "ä¹™":"æœ¨", "å¯…":"æœ¨", "å¯":"æœ¨", "ä¸™":"ç«", "ä¸":"ç«", "å·³":"ç«", "åˆ":"ç«", "æˆŠ":"åœŸ", "å·±":"åœŸ", "è¾°":"åœŸ", "æˆŒ":"åœŸ", "ä¸‘":"åœŸ", "æœª":"åœŸ", "åºš":"é‡‘", "è¾›":"é‡‘", "ç”³":"é‡‘", "é…‰":"é‡‘", "å£¬":"æ°´", "ç™¸":"æ°´", "äº¥":"æ°´", "å­":"æ°´" };
        const YINYANG = { "ç”²":1, "ä¹™":0, "ä¸™":1, "ä¸":0, "æˆŠ":1, "å·±":0, "åºš":1, "è¾›":0, "å£¬":1, "ç™¸":0 };
        const ELEMENTS = ["æœ¨", "ç«", "åœŸ", "é‡‘", "æ°´"];
        const ZHI_CANG_GAN = { "å­":["ç™¸"], "ä¸‘":["å·±","ç™¸","è¾›"], "å¯…":["ç”²","ä¸™","æˆŠ"], "å¯":["ä¹™"], "è¾°":["æˆŠ","ä¹™","ç™¸"], "å·³":["ä¸™","åºš","æˆŠ"], "åˆ":["ä¸","å·±"], "æœª":["å·±","ä¸","ä¹™"], "ç”³":["åºš","å£¬","æˆŠ"], "é…‰":["è¾›"], "æˆŒ":["æˆŠ","è¾›","ä¸"], "äº¥":["å£¬","ç”²"] };
        const DM_TRAITS = { "ç”²":"ç”²æœ¨åƒå¤©ï¼Œå‰›æ¯…æ­£ç›´ï¼Œæœ‰è²¬ä»»æ„Ÿï¼Œé ˜å°é¢¨ç¯„ã€‚", "ä¹™":"ä¹™æœ¨å¦‚è—¤ï¼ŒæŸ”é †å …éŸŒï¼Œå¿ƒæ€ç´°è†©ï¼Œå–„éš¨æ©Ÿæ‡‰è®Šã€‚", "ä¸™":"ä¸™ç«å¦‚é™½ï¼Œç†±æƒ…é–‹æœ—ï¼Œä¸æ‹˜å°ç¯€ï¼Œæƒ…ç·’ä¾†å»å¿«ã€‚", "ä¸":"ä¸ç«å¦‚ç‡­ï¼Œæº«å’Œç´°è†©ï¼Œæ´å¯ŸåŠ›å¼·ï¼Œå¯Œæœ‰å¥‰ç»ç²¾ç¥ã€‚", "æˆŠ":"æˆŠåœŸå¦‚å±±ï¼Œæ²ˆç©©åšé‡ï¼Œè¬›ä¿¡ç”¨ï¼ŒåŒ…å®¹åŠ›å¼·ã€‚", "å·±":"å·±åœŸå¦‚åœ’ï¼ŒæŸ”å’Œå¤šæ‰ï¼Œé€šæƒ…é”ç†ï¼Œå–„æºé€šã€‚", "åºš":"åºšé‡‘å¦‚éµï¼Œå‰›æ¯…æœæ±ºï¼Œè¬›ç¾©æ°£ï¼ŒåŸ·è¡ŒåŠ›å¼·ã€‚", "è¾›":"è¾›é‡‘å¦‚ç ï¼Œæº«æ½¤ç§€æ°£ï¼Œè‡ªå°Šå¼·ï¼Œå¤–æŸ”å…§å‰›ã€‚", "å£¬":"å£¬æ°´å¦‚æµ·ï¼Œè°æ˜æ©Ÿæ™ºï¼Œå¯¬å®å¤§é‡ï¼Œå–œè‡ªç”±ã€‚", "ç™¸":"ç™¸æ°´å¦‚éœ²ï¼Œå…§æ–‚å¹³éœï¼Œæº«æŸ”ç´°å¿ƒï¼Œä»¥æŸ”å…‹å‰›ã€‚" };
        let myChart = null;

        function calculateBazi() {
            try {
                if (typeof Solar === 'undefined') { alert("ç³»çµ±è¼‰å…¥ä¸­..."); return; }
                const input = document.getElementById('birthDate').value;
                if (!input) { alert("è«‹é¸æ“‡ç”Ÿè¾°ï¼"); return; }

                const dateObj = new Date(input);
                const solar = Solar.fromDate(dateObj);
                const lunar = solar.getLunar();
                const bazi = lunar.getEightChar();

                const Gan = [bazi.getYearGan(), bazi.getMonthGan(), bazi.getDayGan(), bazi.getTimeGan()];
                const Zhi = [bazi.getYearZhi(), bazi.getMonthZhi(), bazi.getDayZhi(), bazi.getTimeZhi()];
                const DM = Gan[2];

                // æ¸²æŸ“
                renderStem("year-gan", Gan[0], DM); renderStem("month-gan", Gan[1], DM); renderStem("day-gan", Gan[2], DM, true); renderStem("time-gan", Gan[3], DM);
                renderBranch("year-zhi", Zhi[0], DM); renderBranch("month-zhi", Zhi[1], DM); renderBranch("day-zhi", Zhi[2], DM); renderBranch("time-zhi", Zhi[3], DM);

                // æ€§æ ¼
                document.getElementById('dm-label').innerText = `ã€${DM}ã€‘`;
                document.getElementById('dm-desc').innerText = DM_TRAITS[DM];

                // äº”è¡Œçµ±è¨ˆèˆ‡å»ºè­°
                const counts = { "é‡‘":0, "æœ¨":0, "æ°´":0, "ç«":0, "åœŸ":0 };
                [...Gan, ...Zhi].forEach(c => counts[WUXING[c]]++);
                
                // ç•«åœ–
                const ctx = document.getElementById('wuxingChart').getContext('2d');
                if (myChart) myChart.destroy();
                const dataVals = [counts['æœ¨'], counts['ç«'], counts['åœŸ'], counts['é‡‘'], counts['æ°´']];
                myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['æœ¨','ç«','åœŸ','é‡‘','æ°´'],
                        datasets: [{ label: 'æ•¸é‡', data: dataVals, backgroundColor: ['#388E3C','#D32F2F','#795548','#FBC02D','#1976D2'] }]
                    },
                    options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }, plugins: { legend: { display: false } } }
                });

                // æ‚¨çš„å°ˆå±¬å»ºè­°æ–‡å­—é‚è¼¯
                let summary = [];
                if (counts['é‡‘'] < 1) summary.push("ç¼ºé‡‘, è¦å¦‚ä½•è£œè¶³, è¶•å¿«è©¢å•å¤šå¤šè€å¸«");
                if (counts['æœ¨'] < 1) summary.push("ç¼ºæœ¨, è¦å¦‚ä½•è£œè¶³, è¶•å¿«è©¢å•å¤šå¤šè€å¸«");
                if (counts['æ°´'] < 1) summary.push("ç¼ºæ°´, è¦å¦‚ä½•è£œè¶³, è¶•å¿«è©¢å•å¤šå¤šè€å¸«");
                if (counts['ç«'] < 1) summary.push("ç¼ºç«, è¦å¦‚ä½•è£œè¶³, è¶•å¿«è©¢å•å¤šå¤šè€å¸«");
                if (counts['åœŸ'] < 1) summary.push("ç¼ºåœŸ, è¦å¦‚ä½•è£œè¶³, è¶•å¿«è©¢å•å¤šå¤šè€å¸«");
                let maxVal = Math.max(...dataVals);
                if (maxVal >= 4) summary.push("æŸè¡Œéæ—º, è¦å¦‚ä½•è€—æ³„, è¶•å¿«è©¢å•å¤šå¤šè€å¸«");
                
                document.getElementById('wuxing-text').innerText = summary.length > 0 ? summary.join("ï¼›") : "äº”è¡Œåˆ†ä½ˆç›¸å°å¹³è¡¡ï¼Œæ™‚æ©Ÿåœ¨å“ªï¼Ÿè¶•å¿«è©¢å•å¤šå¤šè€å¸«";

                document.getElementById('bazi-result').style.display = 'block';

            } catch (e) { alert("éŒ¯èª¤ï¼š" + e.message); }
        }

        function getTenGod(dm, target) {
            if (dm === target) return ""; 
            const relation = (ELEMENTS.indexOf(WUXING[target]) - ELEMENTS.indexOf(WUXING[dm]) + 5) % 5;
            const same = YINYANG[dm] === YINYANG[target];
            const gods = [
                same?"æ¯”è‚©":"åŠ«è²¡", same?"é£Ÿç¥":"å‚·å®˜", same?"åè²¡":"æ­£è²¡", same?"ä¸ƒæ®º":"æ­£å®˜", same?"åå°":"æ­£å°"
            ];
            return gods[relation];
        }

        function renderStem(id, char, dm, isDay=false) {
            const god = isDay ? "" : getTenGod(dm, char);
            const color = `w-${WUXING[char] === 'é‡‘' ? 'metal' : WUXING[char] === 'æœ¨' ? 'wood' : WUXING[char] === 'æ°´' ? 'water' : WUXING[char] === 'ç«' ? 'fire' : 'earth'}`;
            document.getElementById(id).innerHTML = `<div class="ten-god-top">${god}</div><div class="char-main ${color}">${char}</div>`;
        }

        function renderBranch(id, char, dm) {
            const color = `w-${WUXING[char] === 'é‡‘' ? 'metal' : WUXING[char] === 'æœ¨' ? 'wood' : WUXING[char] === 'æ°´' ? 'water' : WUXING[char] === 'ç«' ? 'fire' : 'earth'}`;
            const hidden = ZHI_CANG_GAN[char].map(g => `${g}(${getTenGod(dm, g).substring(0,1)})`).join(' ');
            document.getElementById(id).innerHTML = `<div class="char-main ${color}">${char}</div><div class="hidden-stems">${hidden}</div>`;
        }

    </script>
</body>
</html>
